<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EarnEXM Pro - InisTa</title>
    <style>
        :root { --y: #ffcc00; --g: #28a745; --p: #ff4d94; --bg: #000c24; --card: #1e2329; }
        body { margin: 0; background: var(--bg); color: white; font-family: sans-serif; text-align: center; }
        
        /* Balance Bar (Split Green/Yellow) */
        .balance-header { display: flex; width: 95%; margin: 10px auto; border-radius: 10px; overflow: hidden; height: 45px; font-weight: 900; border: 1px solid #333; }
        .exm-part { background: var(--y); color: black; flex: 1; line-height: 45px; }
        .usdt-part { background: var(--g); color: black; flex: 1; line-height: 45px; }

        /* Gamee Style Grid */
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 15px; }
        .card { background: var(--card); padding: 20px 10px; border-radius: 15px; border-bottom: 4px solid #000; font-size: 0.8rem; font-weight: bold; }
        .card:active { transform: translateY(3px); border-bottom: 0; }
        
        /* Wheel UI (Pink & Yellow) */
        .wheel-area { position: relative; width: 300px; height: 300px; margin: 20px auto; border: 8px solid var(--y); border-radius: 50%; }
        .pin { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 30px; height: 30px; background: white; clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 5; }
        canvas { border-radius: 50%; background: white; }

        /* Buttons */
        .btn-main { background: var(--y); color: var(--g); border: none; border-radius: 12px; padding: 15px; width: 85%; font-size: 1.4rem; font-weight: 900; box-shadow: 0 5px 0 #b38f00; margin: 10px 0; }
        .hidden { display: none !important; }
        .timer-icon { font-size: 4rem; margin: 15px; }
    </style>
</head>
<body>

    <div style="display: flex; justify-content: space-between; padding: 10px;">
        <button onclick="goHome()" style="background:none; border:none; color:white; font-weight:bold;">‚óÄ Back</button>
        <button onclick="window.close()" style="background:none; border:none; color:white; font-weight:bold;">Exit ‚úñ</button>
    </div>

    <div class="balance-header">
        <div class="exm-part">EXM: <span id="e-val">0</span></div>
        <div class="usdt-part">USDT: <span id="u-val">0.00</span></div>
    </div>

    <div id="h-view" class="menu-grid">
        <div class="card" onclick="v('s-view')">üé°<br>SPIN</div>
        <div class="card" onclick="v('e-view')">üí∞<br>EARN</div>
        <div class="card" onclick="v('l-view')">üèÜ<br>LUCKY DRAW</div>
        <div class="card" onclick="v('a-view')">ü§ù<br>AFFILIATE</div>
        <div class="card" onclick="v('w-view')" style="grid-column: span 2;">üè¶<br>WITHDRAW</div>
    </div>

    <div id="s-view" class="hidden" style="padding-top:20px;">
        <div class="wheel-area"><div class="pin"></div><canvas id="canvas" width="300" height="300"></canvas></div>
        <button class="btn-main" style="color:black" onclick="spin()">SPIN FOR AD</button>
    </div>

    <div id="e-view" class="hidden" style="padding: 20px;">
        <p>Stay on advertiser page for 1 minute! ‚ö†Ô∏è</p>
        <div class="timer-icon" id="icon">‚è≤Ô∏è</div>
        <h2 id="sec">60s</h2>
        <button id="t-btn" class="btn-main" onclick="task()">Give me a task</button>
    </div>

    <div id="w-view" class="hidden" style="padding:20px;">
        <input type="text" id="w-input" placeholder="Wallet Address" style="width:80%; padding:10px; border-radius:8px;">
        <button class="btn-main" style="color:black" onclick="checkAdmin()">WITHDRAW</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const conf = {
            apiKey: "AIzaSyD3xCKkyQT-6FOURJBjBaTNKOFItL2M87Q",
            authDomain: "earnexmapp-8a0a2.firebaseapp.com",
            projectId: "earnexmapp-8a0a2",
            databaseURL: "https://earnexmapp-8a0a2-default-rtdb.firebaseio.com",
            appId: "1:325148626791:web:0448e65046bb38e365e9c2"
        };

        const app = initializeApp(conf);
        const db = getDatabase(app);
        const uid = window.Telegram?.WebApp?.initDataUnsafe?.user?.id || "InisTa_User";
        const uRef = ref(db, 'users/' + uid);

        const items = ["50 EXM", "0.01$", "Lose", "2$", "5$", "1000 EXM", "1 Spin", "75 EXM", "100 EXM", "0.2$"];

        window.v = (id) => {
            document.querySelectorAll('#h-view, #s-view, #e-view, #w-view').forEach(x => x.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        };
        window.goHome = () => v('h-view');

        // Draw Wheel
        const can = document.getElementById('canvas');
        const ctx = can.getContext('2d');
        function draw() {
            const a = (Math.PI*2)/items.length;
            items.forEach((txt, i) => {
                ctx.fillStyle = i%2==0 ? "#ff4d94" : "#ffcc00";
                ctx.beginPath(); ctx.arc(150,150,145, i*a, (i+1)*a); ctx.lineTo(150,150); ctx.fill();
                ctx.save(); ctx.fillStyle="black"; ctx.translate(150,150); ctx.rotate(i*a+a/2); ctx.fillText(txt, 70, 5); ctx.restore();
            });
        }
        draw();

        // Earn Task
        window.task = () => {
            const b = document.getElementById('t-btn');
            if(b.innerText === "Give me a task") {
                b.innerText = "Take it";
                b.onclick = () => {
                    window.open("https://otieu.com/4/10493012", "_blank");
                    let s = 60;
                    let t = setInterval(() => {
                        s--; document.getElementById('sec').innerText = s+"s";
                        document.getElementById('icon').style.transform = `rotate(${360 - s*6}deg)`;
                        if(s<=0) { clearInterval(t); alert("Success!"); update(uRef, {exm: 50}); goHome(); }
                    }, 1000);
                };
            }
        };

        window.checkAdmin = () => {
            if(document.getElementById('w-input').value === "InisTa") alert("Admin Panel: 125,380,563 Total Players");
            else alert("Withdrawal Pending...");
        };

        onValue(uRef, (s) => {
            const d = s.val() || {exm: 0};
            document.getElementById('e-val').innerText = d.exm;
            document.getElementById('u-val').innerText = (d.exm * 0.00005).toFixed(4);
        });
    </script>
</body>
</html>
